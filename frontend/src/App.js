import { useEffect, useState } from "react";
import { ethers } from "ethers";

const ABI = {
	"_format": "hh-sol-artifact-1",
	"contractName": "MyContract",
	"sourceName": "contracts/DAOProject.sol",
	"abi": [
	  {
		"inputs": [
		  {
			"internalType": "string",
			"name": "initialData",
			"type": "string"
		  }
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	  },
	  {
		"anonymous": false,
		"inputs": [
		  {
			"indexed": false,
			"internalType": "string",
			"name": "oldData",
			"type": "string"
		  },
		  {
			"indexed": false,
			"internalType": "string",
			"name": "newData",
			"type": "string"
		  }
		],
		"name": "DataUpdated",
		"type": "event"
	  },
	  {
		"anonymous": false,
		"inputs": [
		  {
			"indexed": true,
			"internalType": "address",
			"name": "previousOwner",
			"type": "address"
		  },
		  {
			"indexed": true,
			"internalType": "address",
			"name": "newOwner",
			"type": "address"
		  }
		],
		"name": "OwnershipTransferred",
		"type": "event"
	  },
	  {
		"inputs": [],
		"name": "data",
		"outputs": [
		  {
			"internalType": "string",
			"name": "",
			"type": "string"
		  }
		],
		"stateMutability": "view",
		"type": "function"
	  },
	  {
		"inputs": [],
		"name": "owner",
		"outputs": [
		  {
			"internalType": "address",
			"name": "",
			"type": "address"
		  }
		],
		"stateMutability": "view",
		"type": "function"
	  },
	  {
		"inputs": [
		  {
			"internalType": "address",
			"name": "newOwner",
			"type": "address"
		  }
		],
		"name": "transferOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	  },
	  {
		"inputs": [
		  {
			"internalType": "string",
			"name": "newData",
			"type": "string"
		  }
		],
		"name": "updateData",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	  }
	],
	"bytecode": "0x608060405234801561001057600080fd5b50604051611109380380611109833981810160405281019061003291906101fd565b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600190816100819190610467565b5050610539565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6100ef826100a6565b810181811067ffffffffffffffff8211171561010e5761010d6100b7565b5b80604052505050565b6000610121610088565b905061012d82826100e6565b919050565b600067ffffffffffffffff82111561014d5761014c6100b7565b5b610156826100a6565b9050602081019050919050565b60005b83811015610181578082015181840152602081019050610166565b60008484015250505050565b60006101a061019b84610132565b610117565b9050828152602081018484840111156101bc576101bb6100a1565b5b6101c7848285610163565b509392505050565b600082601f8301126101e4576101e361009c565b5b81516101f484826020860161018d565b91505092915050565b60006020828403121561021357610212610092565b5b600082015167ffffffffffffffff81111561023157610230610097565b5b61023d848285016101cf565b91505092915050565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061029857607f821691505b6020821081036102ab576102aa610251565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026103137fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826102d6565b61031d86836102d6565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b600061036461035f61035a84610335565b61033f565b610335565b9050919050565b6000819050919050565b61037e83610349565b61039261038a8261036b565b8484546102e3565b825550505050565b600090565b6103a761039a565b6103b2818484610375565b505050565b5b818110156103d6576103cb60008261039f565b6001810190506103b8565b5050565b601f82111561041b576103ec816102b1565b6103f5846102c6565b81016020851015610404578190505b610418610410856102c6565b8301826103b7565b50505b505050565b600082821c905092915050565b600061043e60001984600802610420565b1980831691505092915050565b6000610457838361042d565b9150826002028217905092915050565b61047082610246565b67ffffffffffffffff811115610489576104886100b7565b5b6104938254610280565b61049e8282856103da565b600060209050601f8311600181146104d157600084156104bf578287015190505b6104c9858261044b565b865550610531565b601f1984166104df866102b1565b60005b82811015610507578489015182556001820191506020850194506020810190506104e2565b868310156105245784890151610520601f89168261042d565b8355505b6001600288020188555050505b505050505050565b610bc1806105486000396000f3fe608060405234801561001057600080fd5b506004361061004c5760003560e01c806368446ead1461005157806373d4a13a1461006d5780638da5cb5b1461008b578063f2fde38b146100a9575b600080fd5b61006b600480360381019061006691906105f5565b6100c5565b005b61007561022f565b60405161008291906106bd565b60405180910390f35b6100936102bd565b6040516100a09190610720565b60405180910390f35b6100c360048036038101906100be9190610767565b6102e1565b005b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610153576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161014a906107e0565b60405180910390fd5b6000600180546101629061082f565b80601f016020809104026020016040519081016040528092919081815260200182805461018e9061082f565b80156101db5780601f106101b0576101008083540402835291602001916101db565b820191906000526020600020905b8154815290600101906020018083116101be57829003601f168201915b5050505050905081600190816101f19190610a16565b507fee986145c636aca5c6c0b4ce0e9d371e77ab30b3e28fe5c3a8d977f05fc8cf248183604051610223929190610ae8565b60405180910390a15050565b6001805461023c9061082f565b80601f01602080910402602001604051908101604052809291908181526020018280546102689061082f565b80156102b55780601f1061028a576101008083540402835291602001916102b5565b820191906000526020600020905b81548152906001019060200180831161029857829003601f168201915b505050505081565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461036f576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610366906107e0565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16036103de576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103d590610b6b565b60405180910390fd5b8073ffffffffffffffffffffffffffffffffffffffff1660008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a3806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b610502826104b9565b810181811067ffffffffffffffff82111715610521576105206104ca565b5b80604052505050565b600061053461049b565b905061054082826104f9565b919050565b600067ffffffffffffffff8211156105605761055f6104ca565b5b610569826104b9565b9050602081019050919050565b82818337600083830152505050565b600061059861059384610545565b61052a565b9050828152602081018484840111156105b4576105b36104b4565b5b6105bf848285610576565b509392505050565b600082601f8301126105dc576105db6104af565b5b81356105ec848260208601610585565b91505092915050565b60006020828403121561060b5761060a6104a5565b5b600082013567ffffffffffffffff811115610629576106286104aa565b5b610635848285016105c7565b91505092915050565b600081519050919050565b600082825260208201905092915050565b60005b8381101561067857808201518184015260208101905061065d565b60008484015250505050565b600061068f8261063e565b6106998185610649565b93506106a981856020860161065a565b6106b2816104b9565b840191505092915050565b600060208201905081810360008301526106d78184610684565b905092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061070a826106df565b9050919050565b61071a816106ff565b82525050565b60006020820190506107356000830184610711565b92915050565b610744816106ff565b811461074f57600080fd5b50565b6000813590506107618161073b565b92915050565b60006020828403121561077d5761077c6104a5565b5b600061078b84828501610752565b91505092915050565b7f4e6f742074686520636f6e7472616374206f776e657200000000000000000000600082015250565b60006107ca601683610649565b91506107d582610794565b602082019050919050565b600060208201905081810360008301526107f9816107bd565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061084757607f821691505b60208210810361085a57610859610800565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026108c27fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610885565b6108cc8683610885565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b600061091361090e610909846108e4565b6108ee565b6108e4565b9050919050565b6000819050919050565b61092d836108f8565b6109416109398261091a565b848454610892565b825550505050565b600090565b610956610949565b610961818484610924565b505050565b5b818110156109855761097a60008261094e565b600181019050610967565b5050565b601f8211156109ca5761099b81610860565b6109a484610875565b810160208510156109b3578190505b6109c76109bf85610875565b830182610966565b50505b505050565b600082821c905092915050565b60006109ed600019846008026109cf565b1980831691505092915050565b6000610a0683836109dc565b9150826002028217905092915050565b610a1f8261063e565b67ffffffffffffffff811115610a3857610a376104ca565b5b610a42825461082f565b610a4d828285610989565b600060209050601f831160018114610a805760008415610a6e578287015190505b610a7885826109fa565b865550610ae0565b601f198416610a8e86610860565b60005b82811015610ab657848901518255600182019150602085019450602081019050610a91565b86831015610ad35784890151610acf601f8916826109dc565b8355505b6001600288020188555050505b505050505050565b60006040820190508181036000830152610b028185610684565b90508181036020830152610b168184610684565b90509392505050565b7f496e76616c696420616464726573730000000000000000000000000000000000600082015250565b6000610b55600f83610649565b9150610b6082610b1f565b602082019050919050565b60006020820190508181036000830152610b8481610b48565b905091905056fea2646970667358221220fd0fb0b09d3da4870c02526771e5744400d27c1d6cae00e3f816ff82b700bae364736f6c634300081c0033",
	"deployedBytecode": "0x608060405234801561001057600080fd5b506004361061004c5760003560e01c806368446ead1461005157806373d4a13a1461006d5780638da5cb5b1461008b578063f2fde38b146100a9575b600080fd5b61006b600480360381019061006691906105f5565b6100c5565b005b61007561022f565b60405161008291906106bd565b60405180910390f35b6100936102bd565b6040516100a09190610720565b60405180910390f35b6100c360048036038101906100be9190610767565b6102e1565b005b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610153576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161014a906107e0565b60405180910390fd5b6000600180546101629061082f565b80601f016020809104026020016040519081016040528092919081815260200182805461018e9061082f565b80156101db5780601f106101b0576101008083540402835291602001916101db565b820191906000526020600020905b8154815290600101906020018083116101be57829003601f168201915b5050505050905081600190816101f19190610a16565b507fee986145c636aca5c6c0b4ce0e9d371e77ab30b3e28fe5c3a8d977f05fc8cf248183604051610223929190610ae8565b60405180910390a15050565b6001805461023c9061082f565b80601f01602080910402602001604051908101604052809291908181526020018280546102689061082f565b80156102b55780601f1061028a576101008083540402835291602001916102b5565b820191906000526020600020905b81548152906001019060200180831161029857829003601f168201915b505050505081565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461036f576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610366906107e0565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16036103de576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103d590610b6b565b60405180910390fd5b8073ffffffffffffffffffffffffffffffffffffffff1660008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a3806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b610502826104b9565b810181811067ffffffffffffffff82111715610521576105206104ca565b5b80604052505050565b600061053461049b565b905061054082826104f9565b919050565b600067ffffffffffffffff8211156105605761055f6104ca565b5b610569826104b9565b9050602081019050919050565b82818337600083830152505050565b600061059861059384610545565b61052a565b9050828152602081018484840111156105b4576105b36104b4565b5b6105bf848285610576565b509392505050565b600082601f8301126105dc576105db6104af565b5b81356105ec848260208601610585565b91505092915050565b60006020828403121561060b5761060a6104a5565b5b600082013567ffffffffffffffff811115610629576106286104aa565b5b610635848285016105c7565b91505092915050565b600081519050919050565b600082825260208201905092915050565b60005b8381101561067857808201518184015260208101905061065d565b60008484015250505050565b600061068f8261063e565b6106998185610649565b93506106a981856020860161065a565b6106b2816104b9565b840191505092915050565b600060208201905081810360008301526106d78184610684565b905092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061070a826106df565b9050919050565b61071a816106ff565b82525050565b60006020820190506107356000830184610711565b92915050565b610744816106ff565b811461074f57600080fd5b50565b6000813590506107618161073b565b92915050565b60006020828403121561077d5761077c6104a5565b5b600061078b84828501610752565b91505092915050565b7f4e6f742074686520636f6e7472616374206f776e657200000000000000000000600082015250565b60006107ca601683610649565b91506107d582610794565b602082019050919050565b600060208201905081810360008301526107f9816107bd565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061084757607f821691505b60208210810361085a57610859610800565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026108c27fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610885565b6108cc8683610885565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b600061091361090e610909846108e4565b6108ee565b6108e4565b9050919050565b6000819050919050565b61092d836108f8565b6109416109398261091a565b848454610892565b825550505050565b600090565b610956610949565b610961818484610924565b505050565b5b818110156109855761097a60008261094e565b600181019050610967565b5050565b601f8211156109ca5761099b81610860565b6109a484610875565b810160208510156109b3578190505b6109c76109bf85610875565b830182610966565b50505b505050565b600082821c905092915050565b60006109ed600019846008026109cf565b1980831691505092915050565b6000610a0683836109dc565b9150826002028217905092915050565b610a1f8261063e565b67ffffffffffffffff811115610a3857610a376104ca565b5b610a42825461082f565b610a4d828285610989565b600060209050601f831160018114610a805760008415610a6e578287015190505b610a7885826109fa565b865550610ae0565b601f198416610a8e86610860565b60005b82811015610ab657848901518255600182019150602085019450602081019050610a91565b86831015610ad35784890151610acf601f8916826109dc565b8355505b6001600288020188555050505b505050505050565b60006040820190508181036000830152610b028185610684565b90508181036020830152610b168184610684565b90509392505050565b7f496e76616c696420616464726573730000000000000000000000000000000000600082015250565b6000610b55600f83610649565b9150610b6082610b1f565b602082019050919050565b60006020820190508181036000830152610b8481610b48565b905091905056fea2646970667358221220fd0fb0b09d3da4870c02526771e5744400d27c1d6cae00e3f816ff82b700bae364736f6c634300081c0033",
	"linkReferences": {},
	"deployedLinkReferences": {}
  }
  

const CONTRACT_ADDRESS = "0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512"; // Replace with actual contract address

function App() {
  const [account, setAccount] = useState(null);
  const [contract, setContract] = useState(null);
  const [data, setData] = useState("");
  const [input, setInput] = useState("");
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");

  const connectWallet = async () => {
    try {
      if (window.ethereum) {
        const provider = new ethers.BrowserProvider(window.ethereum);
        const signer = await provider.getSigner();
        const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });

        const contractInstance = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
        const currentData = await contractInstance.data();

        setAccount(accounts[0]);
        setContract(contractInstance);
        setData(currentData);
        setError("");
      } else {
        setError("Please install MetaMask!");
      }
    } catch (err) {
      console.error(err);
      setError("Failed to connect wallet or load contract data.");
    }
  };

  useEffect(() => {
    connectWallet();
  }, []);

  const updateData = async () => {
    if (!contract) {
      setError("Contract not initialized.");
      return;
    }

    try {
      setLoading(true);
      setError("");
      const tx = await contract.updateData(input);
      await tx.wait();
      const newData = await contract.data();
      setData(newData);
      setInput("");
    } catch (err) {
      console.error(err);
      setError("Transaction failed.");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={{ padding: "20px", fontFamily: "Arial, sans-serif" }}>
      <h1>MyContract Dashboard</h1>

      {error && <p style={{ color: "red" }}>{error}</p>}

      {!account ? (
        <button onClick={connectWallet}>Connect Wallet</button>
      ) : (
        <>
          <p><strong>Connected Wallet:</strong> {account}</p>
          <p><strong>Current Data:</strong> {data}</p>

          <input
            value={input}
            onChange={(e) => setInput(e.target.value)}
            placeholder="New data"
            style={{ marginRight: "10px", padding: "5px" }}
          />
          <button onClick={updateData} disabled={loading || input === ""}>
            {loading ? "Updating..." : "Update"}
          </button>
        </>
      )}
    </div>
  );
}

export default App;
